<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="back 2 basix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="back 2 basix Atom Feed"><title data-react-helmet="true">Orchestration and Choreography | back 2 basix</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Orchestration and Choreography | back 2 basix"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2022-06-17T00:00:00.000Z"><meta data-react-helmet="true" property="article:author" content="https://github.com/nolo28mokgosi"><meta data-react-helmet="true" property="article:tag" content="architecture,design"><link data-react-helmet="true" rel="shortcut icon" href="/img/fav.ico"><link data-react-helmet="true" rel="canonical" href="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography"><link data-react-helmet="true" rel="alternate" href="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2494e176.css">
<link rel="preload" href="/assets/js/runtime~main.aca12976.js" as="script">
<link rel="preload" href="/assets/js/main.e25fa4a6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.png" alt="nolomokgosi" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/profile.png" alt="nolomokgosi" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">@nolomokgosi</b></a><a class="navbar__item navbar__link" href="/docs/intro">Nuggets</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://www.youtube.com/channel/UC3AEKSd1yyYn7W3XHF1lYWA" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Vlog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></div><div class="navbar__items navbar__items--right"><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">üåú</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">üåû</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_q+wC thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_9G5K margin-bottom--md">Recent posts</div><ul class="sidebarItemList_6T4b"><li class="sidebarItem_cjdF"><a aria-current="page" class="sidebarItemLink_zyXk sidebarItemLinkActive_wcJs" href="/blog/orchestrationvschoreography">Orchestration and Choreography</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/createC4diagrams">Creating C4 diagrams</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/sequencediagramonc4">Sequence on C4</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/introductiontoc4">Introduction to C4 Diagramming</a></li><li class="sidebarItem_cjdF"><a class="sidebarItemLink_zyXk" href="/blog/understandingboundaries">Understanding Boundaries</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_d4p0" itemprop="headline">Orchestration and Choreography</h1><div class="blogPostData_-Im+ margin-vert--md"><time datetime="2022-06-17T00:00:00.000Z" itemprop="datePublished">June 17, 2022</time> ¬∑ <!-- -->4 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_8c0z"><div class="avatar margin-bottom--sm"><a href="https://github.com/nolo28mokgosi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img class="image_9q7L" src="/img/profile.png" alt="Nolo Mokgosi"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nolo28mokgosi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nolo Mokgosi</span></a></div><small class="avatar__subtitle" itemprop="description">admin</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_y2LR" id="introduction">Introduction<a aria-hidden="true" class="hash-link" href="#introduction" title="Direct link to heading">‚Äã</a></h2><p>I have been involved in multiple orchestration vs choreography conversation. Conversation are normally about which one is better. At the end of most conversations, there‚Äôs no common ground, all goes down to preference. </p><p>One Friday morning on my way to work I listened to <a href="https://www.infoq.com/podcasts/design-time-coupling-microservices/" target="_blank" rel="noopener noreferrer">Design time coupling in microservices</a> podcast and Chris Richardson touched on this subject. When the host asked him to talk about orchestration and choreography he said ‚ÄúI use those terms in the context of a saga pattern‚Äù.
That‚Äôs when the penny dropped and I thought...this makes sense.</p><p>In this post I will define these concepts and explain the relation between saga,orchestration and choreography. </p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="saga-pattern">Saga Pattern<a aria-hidden="true" class="hash-link" href="#saga-pattern" title="Direct link to heading">‚Äã</a></h2><p>Saga is a sequence of transactions that updates services. Each service publishes a message or event to trigger the next transaction in the saga <!-- -->[#2]<!-- -->.
Saga provides transaction management using sequence of local transactions <!-- -->[#3]<!-- -->.</p><p>Transaction is single unit of logic or work. Transaction can have one or more operations which we‚Äôll refer to as local transactions in this post.</p><p>Let‚Äôs take an example where a user books a holiday via a web portal. Booking process will include:</p><ol><li>Request booking</li><li>Making payment </li><li>Send confirmation email</li></ol><p>There are 2 ways to design the system:</p><ol><li>Single service that perform all operations at once. Example, 2 phase commit (2PC) type of transaction where all services in the transaction are required to commit or rollback before transaction can commit.</li></ol><p><img alt="2pc transaction" src="/assets/images/transaction-2pc-0bcec117097334fb9b70a392f8b8191f.png"></p><ol start="2"><li>Multiple services performing local transactions (Saga Pattern).</li></ol><p><img alt="2pc transaction" src="/assets/images/transaction-saga-5dd5563f7ef99ca3d2cfcda9ef58ef6e.png"></p><p>There are 2 ways to implement a saga pattern, orchestration-based and choreography-based. </p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="orchestration">Orchestration<a aria-hidden="true" class="hash-link" href="#orchestration" title="Direct link to heading">‚Äã</a></h2><p>According to Cambridge dictionary, orchestration is ‚Äúan arrangement of a piece of music to be played by an orchestra‚Äù.</p><p>When I think of orchestration, I see a group of musicians with their different instruments, playing a melodic tune that touches the heart. I also see a conductor, someone who directs the orchestra with a conducting baton.
<img alt="ochestraonstrage" src="/assets/images/orchestra-22ce6b634bb73ae227184ef61fcb2ce7.jpg"></p><sub><sup>sso.org</sup></sub><h3 class="anchor anchorWithStickyNavbar_y2LR" id="orchestration-based-saga">Orchestration-based Saga<a aria-hidden="true" class="hash-link" href="#orchestration-based-saga" title="Direct link to heading">‚Äã</a></h3><p>In orchestration-based saga, a centralised controller(orchestrator) tells services(saga participants) what local transactions to execute <!-- -->[#3]<!-- -->. The orchestrator then interprets state of each operation based on the feedback from the participant.</p><p><img alt="choreographysaga" src="/assets/images/orchestration-design-3fc27697d51395c6000d754c165105d2.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="advantages">Advantages<a aria-hidden="true" class="hash-link" href="#advantages" title="Direct link to heading">‚Äã</a></h4><ol><li>Great for complex workflows with multiple services including long running local transactions.</li><li>Services participating in a workflow don&#x27;t need to know about commands from other participants.</li><li>Single point to track the saga workflow</li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="disadvantages">Disadvantages<a aria-hidden="true" class="hash-link" href="#disadvantages" title="Direct link to heading">‚Äã</a></h4><ol><li>Centralised coordinator adds another point of failure in the system</li><li>New coordinated design requires additional centralised service.  </li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="choreography">Choreography<a aria-hidden="true" class="hash-link" href="#choreography" title="Direct link to heading">‚Äã</a></h2><p>According to Cambridge dictionary, choreography is ‚Äúthe skill of combining movements into dances to be performed‚Äù.
When I think of choreography I see group of dancers on stage, dancing to music in a well coordinated manner. Each dancer on the stage knows what to do. There is no central point to drive or command.</p><p><img alt="choreographers" src="/assets/images/choreographers-eefe7c6ec7a10dbcbf4c61b4567c243e.jpg"></p><sub><sup>countrytimes.co.uk</sup></sub><h3 class="anchor anchorWithStickyNavbar_y2LR" id="choreography-based-saga">Choreography based saga<a aria-hidden="true" class="hash-link" href="#choreography-based-saga" title="Direct link to heading">‚Äã</a></h3><p>In choreography-based saga, services(saga participants) exchange messages or events without a centralised point of control. Each service publishes events that triggers activities in other services.<strong>Note</strong> Published event can trigger acitivities in multiple services.</p><p><img alt="choreographysaga" src="/assets/images/choreography-design-8ee98b6472352b991d83d35c5e1a250a.png"></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="advantages-1">Advantages<a aria-hidden="true" class="hash-link" href="#advantages-1" title="Direct link to heading">‚Äã</a></h4><ol><li>Good for workflows that do not need  coordination logic.</li><li>Unlike orchestrations-based, it does not require additional additional service implementation.</li><li>Responsibilities are distributed across services participating in the saga therefore .</li></ol><h4 class="anchor anchorWithStickyNavbar_y2LR" id="disadvantages-1">Disadvantages<a aria-hidden="true" class="hash-link" href="#disadvantages-1" title="Direct link to heading">‚Äã</a></h4><ol><li>It can be difficult to track which services listen to which commands.</li><li>Confusion when adding new services in the workflow.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="conclusion">Conclusion<a aria-hidden="true" class="hash-link" href="#conclusion" title="Direct link to heading">‚Äã</a></h2><p>It is a good idea to look at orchestration and choreography as descendants of a saga pattern. This way it forces us to ask ourselves questions like:</p><ol><li>What process/workflow are trying to create?</li><li>What activities do we want to trigger when &quot;X&quot; happens?</li></ol><p>There&#x27;s slight difference in terms of type of messages being exchanged between the patterns.
Orchestration-based saga utilised commands more and choreography-based saga can operate on events only. </p><p>There‚Äôs no right or wrong in both orchestration and choreography. Both approaches works but it‚Äôs important to look at pros &amp; cons for both. It‚Äôs also important to consider factors around implementing a saga pattern including:</p><ol><li>Data consistency for processes spanning multiple services <!-- -->[#3]<!-- -->.</li><li>Maintainability and ability to debug as more services are added in the process.</li><li>Idempotence to ensure data consistency and reduce side-effects.</li><li>Observability implementation is key.</li><li>Ability to track workflows.</li><li>Compensating transactions to undo changes that were made by other transactions.</li></ol><h2 class="anchor anchorWithStickyNavbar_y2LR" id="reference">Reference<a aria-hidden="true" class="hash-link" href="#reference" title="Direct link to heading">‚Äã</a></h2><p>#1 InfoQ&#x27;s <a href="https://www.infoq.com/podcasts/design-time-coupling-microservices/" target="_blank" rel="noopener noreferrer">Chris Richardson on Design-Time Coupling in Microservices</a></p><p>#2  <a href="https://microservices.io/patterns/data/saga.html" target="_blank" rel="noopener noreferrer">Patterns: Saga</a> by miroservices.io</p><p>#3 Microsoft&#x27;s <a href="https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/saga/saga" target="_blank" rel="noopener noreferrer">Saga distributed transactions pattern</a></p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_xD8n"><div class="col"><b>Tags:</b><ul class="tags_NBRY padding--none margin-left--sm"><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/architecture">architecture</a></li><li class="tag_F03v"><a class="tag_WK-t tagRegular_LXbV" href="/blog/tags/design">design</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/createC4diagrams"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Creating C4 diagrams<!-- --> ¬ª</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#saga-pattern" class="table-of-contents__link toc-highlight">Saga Pattern</a></li><li><a href="#orchestration" class="table-of-contents__link toc-highlight">Orchestration</a><ul><li><a href="#orchestration-based-saga" class="table-of-contents__link toc-highlight">Orchestration-based Saga</a></li></ul></li><li><a href="#choreography" class="table-of-contents__link toc-highlight">Choreography</a><ul><li><a href="#choreography-based-saga" class="table-of-contents__link toc-highlight">Choreography based saga</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Mini Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Nuggets</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learnings</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/nolo28mokgosi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2022 Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.aca12976.js"></script>
<script src="/assets/js/main.e25fa4a6.js"></script>
</body>
</html>