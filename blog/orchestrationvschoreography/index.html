<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="back 2 basix RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="back 2 basix Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-75LLZKB7VH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-75LLZKB7VH",{anonymize_ip:!0})</script><title data-rh="true">Orchestration and Choreography | back 2 basix</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Orchestration and Choreography | back 2 basix"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-06-17T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/nolo28mokgosi"><meta data-rh="true" property="article:tag" content="architecture,design"><link data-rh="true" rel="icon" href="/img/fav.ico"><link data-rh="true" rel="canonical" href="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography"><link data-rh="true" rel="alternate" href="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography" hreflang="en"><link data-rh="true" rel="alternate" href="https://nolo28mokgosi@github.io/blog/orchestrationvschoreography" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5a35ea5b.css">
<link rel="preload" href="/assets/js/runtime~main.96f43e07.js" as="script">
<link rel="preload" href="/assets/js/main.0ad9c506.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/profile.png" alt="nolomokgosi" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/profile.png" alt="nolomokgosi" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">@nolomokgosi</b></a><a class="navbar__item navbar__link" href="/docs/intro">Nuggets</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/valuestreaminaction">Value Stream in action</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/businesscapabilitiesinaction">Capabilities in action</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/businesscapabilities">Business Capabilities Map</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/buildrightthingright">Bulding right thing right</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/orchestrationvschoreography">Orchestration and Choreography</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Orchestration and Choreography</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-06-17T00:00:00.000Z" itemprop="datePublished">June 17, 2022</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/nolo28mokgosi" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="/img/profile.png" alt="Nolo Mokgosi"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/nolo28mokgosi" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Nolo Mokgosi</span></a></div><small class="avatar__subtitle" itemprop="description">admin</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">​</a></h2><p>I have been involved in multiple orchestration vs choreography conversation. Conversation are normally about which one is better. At the end of most conversations, there’s no common ground, all goes down to preference. </p><p>One Friday morning on my way to work I listened to <a href="https://www.infoq.com/podcasts/design-time-coupling-microservices/" target="_blank" rel="noopener noreferrer">Design time coupling in microservices</a> podcast and Chris Richardson touched on this subject. When the host asked him to talk about orchestration and choreography he said “I use those terms in the context of a saga pattern”.
That’s when the penny dropped and I thought...this makes sense.</p><p>In this post I will define these concepts and explain the relation between saga,orchestration and choreography. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="saga-pattern">Saga Pattern<a class="hash-link" href="#saga-pattern" title="Direct link to heading">​</a></h2><p>Saga is a sequence of transactions that updates services. Each service publishes a message or event to trigger the next transaction in the saga <!-- -->[#2]<!-- -->.
Saga provides transaction management using sequence of local transactions <!-- -->[#3]<!-- -->.</p><p>Transaction is single unit of logic or work. Transaction can have one or more operations which we’ll refer to as local transactions in this post.</p><p>Let’s take an example where a user books a holiday via a web portal. Booking process will include:</p><ol><li>Request booking</li><li>Making payment </li><li>Send confirmation email</li></ol><p>There are 2 ways to design the system:</p><ol><li>Single service that perform all operations at once. Example, 2 phase commit (2PC) type of transaction where all services in the transaction are required to commit or rollback before transaction can commit.</li></ol><p><img loading="lazy" alt="2pc transaction" src="/assets/images/transaction-2pc-0bcec117097334fb9b70a392f8b8191f.png" width="471" height="291" class="img_ev3q"></p><ol start="2"><li>Multiple services performing local transactions (Saga Pattern).</li></ol><p><img loading="lazy" alt="2pc transaction" src="/assets/images/transaction-saga-5dd5563f7ef99ca3d2cfcda9ef58ef6e.png" width="511" height="281" class="img_ev3q"></p><p>There are 2 ways to implement a saga pattern, orchestration-based and choreography-based. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="orchestration">Orchestration<a class="hash-link" href="#orchestration" title="Direct link to heading">​</a></h2><p>According to Cambridge dictionary, orchestration is “an arrangement of a piece of music to be played by an orchestra”.</p><p>When I think of orchestration, I see a group of musicians with their different instruments, playing a melodic tune that touches the heart. I also see a conductor, someone who directs the orchestra with a conducting baton.
<img loading="lazy" alt="ochestraonstrage" src="/assets/images/orchestra-22ce6b634bb73ae227184ef61fcb2ce7.jpg" width="1140" height="626" class="img_ev3q"></p><sub><sup>sso.org</sup></sub><h3 class="anchor anchorWithStickyNavbar_LWe7" id="orchestration-based-saga">Orchestration-based Saga<a class="hash-link" href="#orchestration-based-saga" title="Direct link to heading">​</a></h3><p>In orchestration-based saga, a centralised controller(orchestrator) tells services(saga participants) what local transactions to execute <!-- -->[#3]<!-- -->. The orchestrator then interprets state of each operation based on the feedback from the participant.</p><p><img loading="lazy" alt="choreographysaga" src="/assets/images/orchestration-design-3fc27697d51395c6000d754c165105d2.png" width="665" height="398" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="advantages">Advantages<a class="hash-link" href="#advantages" title="Direct link to heading">​</a></h4><ol><li>Great for complex workflows with multiple services including long running local transactions.</li><li>Services participating in a workflow don&#x27;t need to know about commands from other participants.</li><li>Single point to track the saga workflow</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages">Disadvantages<a class="hash-link" href="#disadvantages" title="Direct link to heading">​</a></h4><ol><li>Centralised coordinator adds another point of failure in the system</li><li>New coordinated design requires additional centralised service.  </li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="choreography">Choreography<a class="hash-link" href="#choreography" title="Direct link to heading">​</a></h2><p>According to Cambridge dictionary, choreography is “the skill of combining movements into dances to be performed”.
When I think of choreography I see group of dancers on stage, dancing to music in a well coordinated manner. Each dancer on the stage knows what to do. There is no central point to drive or command.</p><p><img loading="lazy" alt="choreographers" src="/assets/images/choreographers-eefe7c6ec7a10dbcbf4c61b4567c243e.jpg" width="2400" height="1600" class="img_ev3q"></p><sub><sup>countrytimes.co.uk</sup></sub><h3 class="anchor anchorWithStickyNavbar_LWe7" id="choreography-based-saga">Choreography based saga<a class="hash-link" href="#choreography-based-saga" title="Direct link to heading">​</a></h3><p>In choreography-based saga, services(saga participants) exchange messages or events without a centralised point of control. Each service publishes events that triggers activities in other services.<strong>Note</strong> Published event can trigger acitivities in multiple services.</p><p><img loading="lazy" alt="choreographysaga" src="/assets/images/choreography-design-8ee98b6472352b991d83d35c5e1a250a.png" width="791" height="280" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="advantages-1">Advantages<a class="hash-link" href="#advantages-1" title="Direct link to heading">​</a></h4><ol><li>Good for workflows that do not need  coordination logic.</li><li>Unlike orchestrations-based, it does not require additional additional service implementation.</li><li>Responsibilities are distributed across services participating in the saga therefore .</li></ol><h4 class="anchor anchorWithStickyNavbar_LWe7" id="disadvantages-1">Disadvantages<a class="hash-link" href="#disadvantages-1" title="Direct link to heading">​</a></h4><ol><li>It can be difficult to track which services listen to which commands.</li><li>Confusion when adding new services in the workflow.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>It is a good idea to look at orchestration and choreography as descendants of a saga pattern. This way it forces us to ask ourselves questions like:</p><ol><li>What process/workflow are trying to create?</li><li>What activities do we want to trigger when &quot;X&quot; happens?</li></ol><p>There&#x27;s slight difference in terms of type of messages being exchanged between the patterns.
Orchestration-based saga utilised commands more and choreography-based saga can operate on events only. </p><p>There’s no right or wrong in both orchestration and choreography. Both approaches works but it’s important to look at pros &amp; cons for both. It’s also important to consider factors around implementing a saga pattern including:</p><ol><li>Data consistency for processes spanning multiple services <!-- -->[#3]<!-- -->.</li><li>Maintainability and ability to debug as more services are added in the process.</li><li>Idempotence to ensure data consistency and reduce side-effects.</li><li>Observability implementation is key.</li><li>Ability to track workflows.</li><li>Compensating transactions to undo changes that were made by other transactions.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reference">Reference<a class="hash-link" href="#reference" title="Direct link to heading">​</a></h2><p>#1 InfoQ&#x27;s <a href="https://www.infoq.com/podcasts/design-time-coupling-microservices/" target="_blank" rel="noopener noreferrer">Chris Richardson on Design-Time Coupling in Microservices</a></p><p>#2  <a href="https://microservices.io/patterns/data/saga.html" target="_blank" rel="noopener noreferrer">Patterns: Saga</a> by miroservices.io</p><p>#3 Microsoft&#x27;s <a href="https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/saga/saga" target="_blank" rel="noopener noreferrer">Saga distributed transactions pattern</a></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/architecture">architecture</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/design">design</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/buildrightthingright"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Bulding right thing right</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/createC4diagrams"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Creating C4 diagrams</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#saga-pattern" class="table-of-contents__link toc-highlight">Saga Pattern</a></li><li><a href="#orchestration" class="table-of-contents__link toc-highlight">Orchestration</a><ul><li><a href="#orchestration-based-saga" class="table-of-contents__link toc-highlight">Orchestration-based Saga</a></li></ul></li><li><a href="#choreography" class="table-of-contents__link toc-highlight">Choreography</a><ul><li><a href="#choreography-based-saga" class="table-of-contents__link toc-highlight">Choreography based saga</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#reference" class="table-of-contents__link toc-highlight">Reference</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Mini Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Nuggets</a></li></ul></div><div class="col footer__col"><div class="footer__title">Learnings</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nolo28mokgosi" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.96f43e07.js"></script>
<script src="/assets/js/main.0ad9c506.js"></script>
</body>
</html>