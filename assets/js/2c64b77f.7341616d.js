"use strict";(globalThis.webpackChunknolo_28_mokgosi=globalThis.webpackChunknolo_28_mokgosi||[]).push([[3762],{191(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/dockerfile-4fdcba473ff67123e0c9e159abf9e5e5.png"},506(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/dockerext-running-f48cf832f57ca075e8a1a8dd07231856.png"},1226(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/aca-1-4b9c95ac90828033c3072184254da518.png"},1393(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/aca-2-6cde9a6e4b7b7a1eb889a1015540226f.png"},1600(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/dockerext-287354015a21dc7bbfa89cfda40db4c2.png"},6004(e,n,i){i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"development/azure/website-on-aca","title":"Containerised website in Azure","description":"Context","source":"@site/docs/development/azure/website-on-aca.md","sourceDirName":"development/azure","slug":"/development/azure/websiteOnAzureContainerisedApps","permalink":"/docs/development/azure/websiteOnAzureContainerisedApps","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"slug":"websiteOnAzureContainerisedApps","sidebar_label":"Containerised website in Azure","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Azure Static Site","permalink":"/docs/development/azure/azure_static_site"},"next":{"title":"Expo Deployment","permalink":"/docs/development/react native/expodeployment"}}');var s=i(4848),r=i(8453);const o={slug:"websiteOnAzureContainerisedApps",sidebar_label:"Containerised website in Azure",sidebar_position:3},a="Containerised website in Azure",c={},l=[{value:"Context",id:"context",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create .NET Web app project",id:"create-net-web-app-project",level:2},{value:"Add Docker files",id:"add-docker-files",level:3},{value:"Build &amp; Test Image",id:"build--test-image",level:2},{value:"Push image to Azure Container Registries",id:"push-image-to-azure-container-registries",level:2},{value:"Deploy to Azure Container Apps (ACA)",id:"deploy-to-azure-container-apps-aca",level:2},{value:"Custom Domain",id:"custom-domain",level:3},{value:"Buy or create certificate",id:"buy-or-create-certificate",level:4},{value:"Setup Custom Domain",id:"setup-custom-domain",level:4},{value:"Reference",id:"reference",level:2}];function d(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"containerised-website-in-azure",children:"Containerised website in Azure"})}),"\n",(0,s.jsx)(n.h2,{id:"context",children:"Context"}),"\n",(0,s.jsx)(n.p,{children:"There are multiple ways of containerising applications in Azure. This article focuses on deploying an application to Azure Container Apps (ACA). Focus is on following:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Creating .NET website (MVC)"}),"\n",(0,s.jsx)(n.li,{children:"Bulding and testing the image"}),"\n",(0,s.jsx)(n.li,{children:"Pushing container to registry"}),"\n",(0,s.jsx)(n.li,{children:"Deploying container to ACA"}),"\n",(0,s.jsx)(n.li,{children:"Binding website to custom domain"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Install ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/desktop/install/mac-install/",children:"Docker"}),". Should you struggle to run docker, follow this ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/install/linux-postinstall/#manage-docker-as-a-non-root-user",children:"post installation"})," steps."]}),"\n",(0,s.jsx)(n.li,{children:"Install VSCode"}),"\n",(0,s.jsxs)(n.li,{children:["Install ",(0,s.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker",children:"docker extension"})," in VS Code"]}),"\n",(0,s.jsx)(n.li,{children:"Create Azure Account"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"create-net-web-app-project",children:"Create .NET Web app project"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create a project folder in your development space"}),"\n",(0,s.jsxs)(n.li,{children:["Execute this command in your project folder",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"dotnet new mvc \u2013name MVCWebApplication"})]}),"\n",(0,s.jsx)(n.li,{children:"Open your project folder in VS Code"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"add-docker-files",children:"Add Docker files"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["On Mac, open command palette (Shift + Commmand + P) and execute ",(0,s.jsx)(n.strong,{children:'"Docker: Add Docker Files to Workspace"'})," command.\nThis will add Dockerfile and .dockerignore file"]}),"\n",(0,s.jsxs)(n.li,{children:["On VS Code terminal, execute ",(0,s.jsx)(n.code,{children:"dotnet build"})," command to build the application. Ensure you have 0 Errors, 0 Warnings."]}),"\n",(0,s.jsxs)(n.li,{children:["Execute ",(0,s.jsx)(n.code,{children:"dotnet publish"})," command to make sure that there won't be issues when building the image."]}),"\n",(0,s.jsxs)(n.li,{children:["Ensure your docker file has ",(0,s.jsx)(n.code,{children:"ENV ASPNETCORE_URLS=http://*:5000:"})," line",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{alt:"dockerfile",src:i(191).A+"",width:"731",height:"474"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"build--test-image",children:"Build & Test Image"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Open command palette (Shift + Commmand + P) and execute ",(0,s.jsx)(n.strong,{children:'"Docker Images: Build Image..."'})," command"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Open docker explorer and make sure the image is available",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{alt:"docker explorer",src:i(1600).A+"",width:"352",height:"330"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'Right click image you want to test and select "Run". In my case it\'s latest under ayobaclientweb'}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The green play button should appear in containers section which allow you to test",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{alt:"docker explorer",src:i(506).A+"",width:"358",height:"413"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:'Right click the green icon and select "Open in Browser".'}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"push-image-to-azure-container-registries",children:"Push image to Azure Container Registries"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["On  portal.azure.com, search for container registry and create one",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{alt:"containerregirsty",src:i(7593).A+"",width:"556",height:"193"})]}),"\n",(0,s.jsxs)(n.li,{children:['On VS Code, registries section, select "Connect Registry" icon and follow steps to connect to Azure. Once connected, under azure icon you should be able to see registry you created in number 1.',(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{alt:"registries",src:i(6334).A+"",width:"354",height:"329"})]}),"\n",(0,s.jsxs)(n.li,{children:['On images section, right click the and select "push". Follow steps to push to the connected azure registry\n',(0,s.jsx)(n.img,{alt:"docker explorer",src:i(1600).A+"",width:"352",height:"330"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"deploy-to-azure-container-apps-aca",children:"Deploy to Azure Container Apps (ACA)"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:['On  portal.azure.com, search for "Container Apps" & create new. Provide required details and click next\n',(0,s.jsx)(n.img,{alt:"containeraaps",src:i(1226).A+"",width:"823",height:"693"})]}),"\n",(0,s.jsxs)(n.li,{children:['Unselect "Use quick image" checkbox and select the image you pushed to azure registry\n',(0,s.jsx)(n.img,{alt:"containeraaps",src:i(1393).A+"",width:"751",height:"612"})]}),"\n",(0,s.jsxs)(n.li,{children:["On the same page, enable ingress and make sure below settings are followed. Click review + create\n",(0,s.jsx)(n.img,{alt:"containeraaps",src:i(7176).A+"",width:"754",height:"692"})]}),"\n",(0,s.jsx)(n.li,{children:'Once container app is created, select "Application URL" on overview section to test the web app'}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"custom-domain",children:"Custom Domain"}),"\n",(0,s.jsx)(n.h4,{id:"buy-or-create-certificate",children:"Buy or create certificate"}),"\n",(0,s.jsxs)(n.p,{children:["To add a custom domain you will need a certificate. You can either buy the certificate or create a free one via ",(0,s.jsx)(n.a,{href:"https://dev.to/shibayan/how-to-quickly-setup-a-lets-encrypt-certificate-in-azure-container-apps-3nd7",children:"Let's Encrypt"}),".\nI chose to buy cert from Go Daddy for $40 for a year. Azure supports managed certificate on app services but not on container apps yet."]}),"\n",(0,s.jsx)(n.p,{children:"GoDaddy provides 5 files (including the private key you download before creating the certificate)"}),"\n",(0,s.jsxs)(n.p,{children:["If your certificate does not have private key, you'll get below error when you try to upload PEM file from GoDaddy.\n",(0,s.jsx)(n.strong,{children:"\u201cFailed to add new private key certificate: [cert name]. Certificate must contain one private key.\u201d"})]}),"\n",(0,s.jsx)(n.p,{children:"To combine private key and cert, you have to"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Convert your private key text to key using below command",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"openssl rsa -in key.txt -outform pem -out cert.key"})]}),"\n",(0,s.jsx)(n.li,{children:"Should you get UTF-8 error when executing above-mentioned command, Open the key file in Notepad++ and verify the encoding. If it says UTF-8-BOM then change it to UTF-8. Save the file and try again.\nAlternatively you can use vs code to change the encoding using the bottom toolbar!\nOnce converted, execute above-mentioned command again"}),"\n",(0,s.jsxs)(n.li,{children:["Combine cert and key using below command",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"openssl pkcs12 -inkey cert.key -in cert.pem -export -out output.pem"}),(0,s.jsx)(n.br,{}),"\n","If you like .pfx file, use below command",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.code,{children:"openssl pkcs12 -inkey cert.key -in cert.crt -export -out output.pfx"})]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"setup-custom-domain",children:"Setup Custom Domain"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Go to your container app"}),"\n",(0,s.jsx)(n.li,{children:'Select "Custom Domain" on the left menu'}),"\n",(0,s.jsx)(n.li,{children:'Select "Add Custom Domain"'}),"\n",(0,s.jsx)(n.li,{children:"Enter domain details, copy CNAME and TXT values and add them to your domain settings with your provider"}),"\n",(0,s.jsx)(n.li,{children:"Validate and bind the certificate"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"containeraaps",src:i(6292).A+"",width:"1404",height:"671"})}),"\n",(0,s.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/container-apps/manage-secrets?tabs=arm-template",children:"Manage secrets in Azure Container Apps"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/azure/container-apps/custom-domains-certificates",children:"Custom domain names and certificates in Azure Container Apps"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://stackoverflow.com/questions/74070712/how-to-override-local-user-secrets-and-appsettings-json-with-azure-container-app",children:"How to override local User Secrets and appsettings.json with Azure Container App's Secrets?"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/ThorstenHans/azure-container-apps-bicep",children:"Deploy Azure Container Apps with Bicep"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.thorsten-hans.com/how-to-deploy-azure-container-apps-with-bicep/",children:"How to deploy Azure Container Apps with Bicep"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},6292(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/customdomain-bfef445714a68ed848df082706708729.png"},6334(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/vscoderegistries-5deca3b108eb44799f41d167cac138ef.png"},7176(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/aca-3-4a2d39d02183f50c86a552e5bb1f8206.png"},7593(e,n,i){i.d(n,{A:()=>t});const t=i.p+"assets/images/containerregistry-0d9393fe27eac1e09d594221c5d51157.png"},8453(e,n,i){i.d(n,{R:()=>o,x:()=>a});var t=i(6540);const s={},r=t.createContext(s);function o(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);