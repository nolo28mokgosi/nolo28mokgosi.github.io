"use strict";(globalThis.webpackChunknolo_28_mokgosi=globalThis.webpackChunknolo_28_mokgosi||[]).push([[1667],{1556(e,n,i){i.d(n,{A:()=>s});const s=i.p+"assets/images/sidecar-c82818ca56341f2c21b5b5119fd41f60.jpg"},5120(e,n,i){i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>a,frontMatter:()=>c,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"development/DI-on-functions","title":"Dependency injection on azure functions","description":"di","source":"@site/docs/development/DI-on-functions.md","sourceDirName":"development","slug":"/development/dependencyinjectiononfunctions","permalink":"/docs/development/dependencyinjectiononfunctions","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"slug":"dependencyinjectiononfunctions","sidebar_label":"DI on function","sidebar_position":3},"sidebar":"tutorialSidebar","previous":{"title":"Expo Deployment","permalink":"/docs/development/react native/expodeployment"},"next":{"title":"AI Context Compression","permalink":"/docs/development/aicontextcompression"}}');var t=i(4848),o=i(8453);const c={slug:"dependencyinjectiononfunctions",sidebar_label:"DI on function",sidebar_position:3},r="Dependency injection on azure functions",l={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Registering Services",id:"registering-services",level:2},{value:"Using dependencies",id:"using-dependencies",level:2},{value:"Issues",id:"issues",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"References",id:"references",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"dependency-injection-on-azure-functions",children:"Dependency injection on azure functions"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"di",src:i(1556).A+"",width:"450",height:"300"})}),"\n",(0,t.jsxs)(n.p,{children:["This document summarizes the microsoft's dependency injection ",(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/functions-dotnet-dependency-injection",children:"tutorial"}),".\nFollowing steps must be followed to achieve IoC(Inversion of control) in Azure functions."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Install prerequisites"}),"\n",(0,t.jsx)(n.li,{children:"Register services"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Microsoft.Azure.Functions.Extensions"}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.NET.Sdk.Functions: Don't install if you already have sdK installed."}),"\n",(0,t.jsx)(n.li,{children:"Microsoft.Extensions.DependencyInjection"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"registering-services",children:"Registering Services"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"using Microsoft.Azure.Functions.Extensions.DependencyInjection;\nusing Microsoft.Extensions.DependencyInjection;\n\n[assembly: FunctionsStartup(typeof(MyNamespace.Startup))]\n\nnamespace MyNamespace\n{\n    public class Startup : FunctionsStartup\n    {\n        public override void Configure(IFunctionsHostBuilder builder)\n        {\n            builder.Services.AddSingleton<IMyService>((s) => {\n                return new MyService();\n            });\n        }\n    }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"using-dependencies",children:"Using dependencies"}),"\n",(0,t.jsx)(n.p,{children:'GetMessage method can be invoked from injected class "IMyService"'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:'using Microsoft.AspNetCore.Http;\nusing Microsoft.AspNetCore.Mvc;\nusing Microsoft.Azure.WebJobs;\nusing Microsoft.Azure.WebJobs.Extensions.Http;\nusing Microsoft.Extensions.Logging;\nusing System.Net.Http;\nusing System.Threading.Tasks;\n\nnamespace MyNamespace\n{\n    public class MyHttpTrigger\n    {\n        private readonly HttpClient _client;\n        private readonly IMyService _service;\n\n        public MyHttpTrigger(IMyService service)\n        {\n            this._service = service;\n        }\n\n        [FunctionName("MyHttpTrigger")]\n        public async Task<IActionResult> Run(\n            [HttpTrigger(AuthorizationLevel.Function, "get", "post", Route = null)] HttpRequest req,\n            ILogger log)\n        {\n            var message = _service.GetMessage();\n\n            return new OkObjectResult("Response from function with injected dependencies.");\n        }\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"issues",children:"Issues"}),"\n",(0,t.jsx)(n.p,{children:"Should you get an error like this \u201cCould not load file or assembly 'Microsoft.Extensions.DependencyInjection.Abstractions, Version=6.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60'. The system cannot find the file specified\u201d"}),"\n",(0,t.jsx)(n.p,{children:"You need to downgrade Microsoft.Extensions* to 3.1.0"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://stackoverflow.com/questions/64809716/could-not-load-file-or-assembly-microsoft-extensions-configuration-abstractions",children:"https://stackoverflow.com/questions/64809716/could-not-load-file-or-assembly-microsoft-extensions-configuration-abstractions"})}),"\n",(0,t.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,t.jsx)(n.p,{children:"It's important to note available service lifeline"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Transient: Created upon resolution of each service."}),"\n",(0,t.jsx)(n.li,{children:"Scope: Created once per function execution. Further requests during execution uses the same instance."}),"\n",(0,t.jsx)(n.li,{children:"Singleton: matches the lifetime of the host and it's reused across multiple executions"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(n.p,{children:["#1: ",(0,t.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/azure-functions/functions-dotnet-dependency-injection",children:"Use dependency injection in .NET Azure Functions"})]})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453(e,n,i){i.d(n,{R:()=>c,x:()=>r});var s=i(6540);const t={},o=s.createContext(t);function c(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);