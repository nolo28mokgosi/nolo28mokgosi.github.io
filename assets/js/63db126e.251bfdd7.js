"use strict";(globalThis.webpackChunknolo_28_mokgosi=globalThis.webpackChunknolo_28_mokgosi||[]).push([[9190],{3149(e,n,s){s.d(n,{A:()=>t});const t=s.p+"assets/images/orchestra-22ce6b634bb73ae227184ef61fcb2ce7.jpg"},4727(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>t,toc:()=>h});var t=s(6480),a=s(4848),i=s(8453);const r={slug:"orchestrationvschoreography",title:"Orchestration and Choreography",authors:"nolo",tags:["architecture","design"]},o=void 0,c={authorsImageUrls:[void 0]},h=[{value:"Introduction",id:"introduction",level:2},{value:"Saga Pattern",id:"saga-pattern",level:2},{value:"Orchestration",id:"orchestration",level:2},{value:"Orchestration-based Saga",id:"orchestration-based-saga",level:3},{value:"Advantages",id:"advantages",level:4},{value:"Disadvantages",id:"disadvantages",level:4},{value:"Choreography",id:"choreography",level:2},{value:"Choreography based saga",id:"choreography-based-saga",level:3},{value:"Advantages",id:"advantages-1",level:4},{value:"Disadvantages",id:"disadvantages-1",level:4},{value:"Conclusion",id:"conclusion",level:2},{value:"Reference",id:"reference",level:2}];function l(e){const n={a:"a",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",strong:"strong",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsx)(n.p,{children:"I have been involved in multiple orchestration vs choreography conversation. Conversation are normally about which one is better. At the end of most conversations, there\u2019s no common ground, all goes down to preference."}),"\n",(0,a.jsxs)(n.p,{children:["One Friday morning on my way to work I listened to ",(0,a.jsx)(n.a,{href:"https://www.infoq.com/podcasts/design-time-coupling-microservices/",children:"Design time coupling in microservices"})," podcast and Chris Richardson touched on this subject. When the host asked him to talk about orchestration and choreography he said \u201cI use those terms in the context of a saga pattern\u201d.\nThat\u2019s when the penny dropped and I thought...this makes sense."]}),"\n",(0,a.jsx)(n.p,{children:"In this post I will define these concepts and explain the relation between saga,orchestration and choreography."}),"\n",(0,a.jsx)(n.h2,{id:"saga-pattern",children:"Saga Pattern"}),"\n",(0,a.jsx)(n.p,{children:"Saga is a sequence of transactions that updates services. Each service publishes a message or event to trigger the next transaction in the saga [#2].\nSaga provides transaction management using sequence of local transactions [#3]."}),"\n",(0,a.jsx)(n.p,{children:"Transaction is single unit of logic or work. Transaction can have one or more operations which we\u2019ll refer to as local transactions in this post."}),"\n",(0,a.jsx)(n.p,{children:"Let\u2019s take an example where a user books a holiday via a web portal. Booking process will include:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Request booking"}),"\n",(0,a.jsx)(n.li,{children:"Making payment"}),"\n",(0,a.jsx)(n.li,{children:"Send confirmation email"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"There are 2 ways to design the system:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Single service that perform all operations at once. Example, 2 phase commit (2PC) type of transaction where all services in the transaction are required to commit or rollback before transaction can commit."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"2pc transaction",src:s(5494).A+"",width:"471",height:"291"})}),"\n",(0,a.jsxs)(n.ol,{start:"2",children:["\n",(0,a.jsx)(n.li,{children:"Multiple services performing local transactions (Saga Pattern)."}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"2pc transaction",src:s(9747).A+"",width:"511",height:"281"})}),"\n",(0,a.jsx)(n.p,{children:"There are 2 ways to implement a saga pattern, orchestration-based and choreography-based."}),"\n",(0,a.jsx)(n.h2,{id:"orchestration",children:"Orchestration"}),"\n",(0,a.jsx)(n.p,{children:"According to Cambridge dictionary, orchestration is \u201can arrangement of a piece of music to be played by an orchestra\u201d."}),"\n",(0,a.jsxs)(n.p,{children:["When I think of orchestration, I see a group of musicians with their different instruments, playing a melodic tune that touches the heart. I also see a conductor, someone who directs the orchestra with a conducting baton.\n",(0,a.jsx)(n.img,{alt:"ochestraonstrage",src:s(3149).A+"",width:"1140",height:"626"}),"\n",(0,a.jsx)("sub",{children:(0,a.jsx)("sup",{children:"sso.org"})})]}),"\n",(0,a.jsx)(n.h3,{id:"orchestration-based-saga",children:"Orchestration-based Saga"}),"\n",(0,a.jsx)(n.p,{children:"In orchestration-based saga, a centralised controller(orchestrator) tells services(saga participants) what local transactions to execute [#3]. The orchestrator then interprets state of each operation based on the feedback from the participant."}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"choreographysaga",src:s(6680).A+"",width:"665",height:"398"})}),"\n",(0,a.jsx)(n.h4,{id:"advantages",children:"Advantages"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Great for complex workflows with multiple services including long running local transactions."}),"\n",(0,a.jsx)(n.li,{children:"Services participating in a workflow don't need to know about commands from other participants."}),"\n",(0,a.jsx)(n.li,{children:"Single point to track the saga workflow"}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"disadvantages",children:"Disadvantages"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Centralised coordinator adds another point of failure in the system"}),"\n",(0,a.jsx)(n.li,{children:"New coordinated design requires additional centralised service."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"choreography",children:"Choreography"}),"\n",(0,a.jsx)(n.p,{children:"According to Cambridge dictionary, choreography is \u201cthe skill of combining movements into dances to be performed\u201d.\nWhen I think of choreography I see group of dancers on stage, dancing to music in a well coordinated manner. Each dancer on the stage knows what to do. There is no central point to drive or command."}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.img,{alt:"choreographers",src:s(5676).A+"",width:"2400",height:"1600"}),"\n",(0,a.jsx)("sub",{children:(0,a.jsx)("sup",{children:"countrytimes.co.uk"})})]}),"\n",(0,a.jsx)(n.h3,{id:"choreography-based-saga",children:"Choreography based saga"}),"\n",(0,a.jsxs)(n.p,{children:["In choreography-based saga, services(saga participants) exchange messages or events without a centralised point of control. Each service publishes events that triggers activities in other services.",(0,a.jsx)(n.strong,{children:"Note"})," Published event can trigger acitivities in multiple services."]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{alt:"choreographysaga",src:s(5378).A+"",width:"791",height:"280"})}),"\n",(0,a.jsx)(n.h4,{id:"advantages-1",children:"Advantages"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Good for workflows that do not need  coordination logic."}),"\n",(0,a.jsx)(n.li,{children:"Unlike orchestrations-based, it does not require additional additional service implementation."}),"\n",(0,a.jsx)(n.li,{children:"Responsibilities are distributed across services participating in the saga therefore ."}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"disadvantages-1",children:"Disadvantages"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"It can be difficult to track which services listen to which commands."}),"\n",(0,a.jsx)(n.li,{children:"Confusion when adding new services in the workflow."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,a.jsx)(n.p,{children:"It is a good idea to look at orchestration and choreography as descendants of a saga pattern. This way it forces us to ask ourselves questions like:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"What process/workflow are trying to create?"}),"\n",(0,a.jsx)(n.li,{children:'What activities do we want to trigger when "X" happens?'}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"There's slight difference in terms of type of messages being exchanged between the patterns.\nOrchestration-based saga utilised commands more and choreography-based saga can operate on events only."}),"\n",(0,a.jsx)(n.p,{children:"There\u2019s no right or wrong in both orchestration and choreography. Both approaches works but it\u2019s important to look at pros & cons for both. It\u2019s also important to consider factors around implementing a saga pattern including:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Data consistency for processes spanning multiple services [#3]."}),"\n",(0,a.jsx)(n.li,{children:"Maintainability and ability to debug as more services are added in the process."}),"\n",(0,a.jsx)(n.li,{children:"Idempotence to ensure data consistency and reduce side-effects."}),"\n",(0,a.jsx)(n.li,{children:"Observability implementation is key."}),"\n",(0,a.jsx)(n.li,{children:"Ability to track workflows."}),"\n",(0,a.jsx)(n.li,{children:"Compensating transactions to undo changes that were made by other transactions."}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,a.jsxs)(n.p,{children:["#1 InfoQ's ",(0,a.jsx)(n.a,{href:"https://www.infoq.com/podcasts/design-time-coupling-microservices/",children:"Chris Richardson on Design-Time Coupling in Microservices"})]}),"\n",(0,a.jsxs)(n.p,{children:["#2  ",(0,a.jsx)(n.a,{href:"https://microservices.io/patterns/data/saga.html",children:"Patterns: Saga"})," by miroservices.io"]}),"\n",(0,a.jsxs)(n.p,{children:["#3 Microsoft's ",(0,a.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/architecture/reference-architectures/saga/saga",children:"Saga distributed transactions pattern"})]})]})}function d(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},5378(e,n,s){s.d(n,{A:()=>t});const t=s.p+"assets/images/choreography-design-8ee98b6472352b991d83d35c5e1a250a.png"},5494(e,n,s){s.d(n,{A:()=>t});const t=s.p+"assets/images/transaction-2pc-0bcec117097334fb9b70a392f8b8191f.png"},5676(e,n,s){s.d(n,{A:()=>t});const t=s.p+"assets/images/choreographers-eefe7c6ec7a10dbcbf4c61b4567c243e.jpg"},6480(e){e.exports=JSON.parse('{"permalink":"/blog/orchestrationvschoreography","source":"@site/blog/2022-06-17-orchestrationvschoreography copy.md","title":"Orchestration and Choreography","description":"Introduction","date":"2022-06-17T00:00:00.000Z","tags":[{"inline":true,"label":"architecture","permalink":"/blog/tags/architecture"},{"inline":true,"label":"design","permalink":"/blog/tags/design"}],"readingTime":4.11,"hasTruncateMarker":true,"authors":[{"name":"Nolo Mokgosi","title":"admin","url":"https://github.com/nolo28mokgosi","imageURL":"/img/profile.png","key":"nolo","page":null}],"frontMatter":{"slug":"orchestrationvschoreography","title":"Orchestration and Choreography","authors":"nolo","tags":["architecture","design"]},"unlisted":false,"prevItem":{"title":"Software that serves users and developers","permalink":"/blog/buildrightthingright"},"nextItem":{"title":"Creating C4 diagrams","permalink":"/blog/createC4diagrams"}}')},6680(e,n,s){s.d(n,{A:()=>t});const t=s.p+"assets/images/orchestration-design-3fc27697d51395c6000d754c165105d2.png"},8453(e,n,s){s.d(n,{R:()=>r,x:()=>o});var t=s(6540);const a={},i=t.createContext(a);function r(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),t.createElement(i.Provider,{value:n},e.children)}},9747(e,n,s){s.d(n,{A:()=>t});const t=s.p+"assets/images/transaction-saga-5dd5563f7ef99ca3d2cfcda9ef58ef6e.png"}}]);